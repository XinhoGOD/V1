<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - NFL Fantasy Trends</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1><i class="fas fa-tachometer-alt"></i> Dashboard - Insights de la Semana</h1>
                <div class="header-controls">
                    <div class="week-selector">
                        <label for="currentWeek">Semana:</label>
                        <select id="currentWeek" class="week-select">
                            <option value="">Seleccionar semana...</option>
                        </select>
                    </div>
                    <button id="refreshDashboard" class="btn-refresh">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-content">
                <!-- Navigation Menu -->
                <nav class="sidebar-nav">
                    <h3><i class="fas fa-bars"></i> Navegación</h3>
                    <ul class="nav-menu">
                        <li>
                            <a href="dashboard.html" class="nav-item active">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="index.html" class="nav-item">
                                <i class="fas fa-users"></i>
                                <span>Jugadores</span>
                            </a>
                        </li>
                        <li>
                            <a href="sleepers.html" class="nav-item">
                                <i class="fas fa-eye"></i>
                                <span>Sleepers</span>
                            </a>
                        </li>
                        <li>
                            <a href="trends.html" class="nav-item">
                                <i class="fas fa-trending-up"></i>
                                <span>Tendencias</span>
                            </a>
                        </li>
                        <li>
                            <a href="fantasy-alert.html" class="nav-item">
                                <i class="fas fa-bell"></i>
                                <span>Fantasy Alert</span>
                            </a>
                        </li>
                        <li>
                            <a href="encuentros.html" class="nav-item">
                                <i class="fas fa-football-ball"></i>
                                <span>Encuentros</span>
                            </a>
                        </li>
                        <li>
                            <a href="settings.html" class="nav-item">
                                <i class="fas fa-cog"></i>
                                <span>Configuración</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <h3><i class="fas fa-chart-bar"></i> Resumen Rápido</h3>
                    <div class="stat-item">
                        <span class="stat-label">Semana Actual:</span>
                        <span id="currentWeekDisplay" class="stat-value">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Jugadores:</span>
                        <span id="totalPlayersCount" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Última Actualización:</span>
                        <span id="lastUpdateTime" class="stat-value">-</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Loading Indicator -->
            <div id="loadingDashboard" class="loading-container">
                <div class="loading-spinner"></div>
                <p>Cargando insights de la semana...</p>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent" class="dashboard-content" style="display: none;">
                
                <!-- Key Metrics Cards -->
                <div class="metrics-grid">
                    <div class="metric-card trending-up">
                        <div class="metric-icon">
                            <i class="fas fa-arrow-trend-up"></i>
                        </div>
                        <div class="metric-content">
                            <h3>Mayor Subida</h3>
                            <p id="topRiser" class="metric-value">-</p>
                            <span id="topRiserChange" class="metric-change">-</span>
                        </div>
                    </div>

                    <div class="metric-card trending-down">
                        <div class="metric-icon">
                            <i class="fas fa-arrow-trend-down"></i>
                        </div>
                        <div class="metric-content">
                            <h3>Mayor Bajada</h3>
                            <p id="topFaller" class="metric-value">-</p>
                            <span id="topFallerChange" class="metric-change">-</span>
                        </div>
                    </div>

                    <div class="metric-card most-added">
                        <div class="metric-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="metric-content">
                            <h3>Más Agregado</h3>
                            <p id="mostAdded" class="metric-value">-</p>
                            <span id="mostAddedCount" class="metric-change">-</span>
                        </div>
                    </div>

                    <div class="metric-card most-dropped">
                        <div class="metric-icon">
                            <i class="fas fa-minus-circle"></i>
                        </div>
                        <div class="metric-content">
                            <h3>Más Eliminado</h3>
                            <p id="mostDropped" class="metric-value">-</p>
                            <span id="mostDroppedCount" class="metric-change">-</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="chart-row">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3>Distribución por Posición</h3>
                                <p>Promedio de % Rostered por posición</p>
                            </div>
                            <canvas id="positionChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h3>Top 10 Jugadores Más Rostered</h3>
                                <p>Jugadores con mayor % rostered esta semana</p>
                            </div>
                            <canvas id="topPlayersChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-row">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3>Tendencia Semanal - Adds vs Drops</h3>
                                <p>Comparación de adds y drops por semana</p>
                            </div>
                            <canvas id="addsDropsTrendChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h3>Cambios Más Significativos</h3>
                                <p>Jugadores con mayores cambios en % rostered</p>
                            </div>
                            <canvas id="biggestChangesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Weekly Insights -->
                <div class="insights-section">
                    <h2><i class="fas fa-lightbulb"></i> Insights de la Semana</h2>
                    
                    <div class="insights-grid">
                        <div class="insight-card">
                            <h4><i class="fas fa-fire"></i> Jugadores en Tendencia</h4>
                            <div id="trendingPlayers" class="insight-content">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <div class="insight-card">
                            <h4><i class="fas fa-exclamation-triangle"></i> Alertas</h4>
                            <div id="weeklyAlerts" class="insight-content">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <div class="insight-card">
                            <h4><i class="fas fa-trophy"></i> Oportunidades</h4>
                            <div id="opportunities" class="insight-content">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <div class="insight-card">
                            <h4><i class="fas fa-chart-line"></i> Estadísticas Clave</h4>
                            <div id="keyStats" class="insight-content">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <div class="insight-card">
                            <h4><i class="fas fa-brain"></i> Análisis Semanal</h4>
                            <div id="weeklyInsights" class="insight-content">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="activity-section">
                    <h2><i class="fas fa-clock"></i> Actividad Reciente</h2>
                    <div class="activity-list" id="recentActivity">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Configuration Button -->
    <button id="configBtn" class="config-btn" title="Configurar Supabase">
        <i class="fas fa-cog"></i>
    </button>

    <!-- Configuration Modal -->
    <div id="configModal" class="modal">
        <div class="modal-content config-modal">
            <div class="modal-header">
                <h2>Configuración de Supabase</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="config-form">
                    <div class="form-group">
                        <label for="supabaseUrl">URL de Supabase:</label>
                        <input type="text" id="supabaseUrl" placeholder="https://tu-proyecto.supabase.co" class="config-input">
                    </div>
                    <div class="form-group">
                        <label for="supabaseKey">Anon Key de Supabase:</label>
                        <input type="password" id="supabaseKey" placeholder="Tu clave anónima" class="config-input">
                    </div>
                    <div class="form-actions">
                        <button id="saveConfig" class="btn-primary">Guardar Configuración</button>
                        <button id="testConnection" class="btn-secondary">Probar Conexión</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
